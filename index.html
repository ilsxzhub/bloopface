<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Homemade Looi â€” AI Robot Eyes</title>
<style>
  body { background:#000; display:flex; flex-direction:column; gap:20px; justify-content:center; align-items:center; height:100vh; color:#8fdcff; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; margin:0; }
  .eye-container { display:flex; gap:100px; }
  .eye { width:120px; height:120px; background:#00f; border-radius:50%; box-shadow:0 0 20px #00f,0 0 40px #00f,0 0 60px #00f; position:relative; overflow:hidden; }
  .eyelid { position:absolute; top:0; left:0; width:100%; height:100%; background:#000; transform:scaleY(0); transform-origin:top; transition:transform 0.15s ease-in-out; }
  .eye.blink .eyelid { transform:scaleY(1); }
  .eye.thinking { animation:thinkPulse 0.9s infinite; }
  @keyframes thinkPulse { 0% { box-shadow:0 0 20px #00f,0 0 40px #00f,0 0 60px #00f; transform:scale(1);} 50% { box-shadow:0 0 40px #00f,0 0 80px #00f,0 0 120px #00f; transform:scale(1.03);} 100% { box-shadow:0 0 20px #00f,0 0 40px #00f,0 0 60px #00f; transform:scale(1);} }
  .panel { width:min(920px,92vw); background:rgba(10,20,30,0.6); border:1px solid rgba(100,200,255,0.12); padding:12px; border-radius:10px; display:flex; gap:12px; align-items:center; justify-content:space-between; }
  .status { font-weight:600; color:#bfefff; }
  .transcript { opacity:0.9; font-size:0.9rem; color:#dff6ff; }
  button { background:#00aaff;color:#fff;border:0;padding:10px 20px;border-radius:12px;cursor:pointer; font-size:18px; }
  @media(max-width:600px){ .eye { width:90px; height:90px } .eye-container { gap:40px } }
</style>
</head>
<body>

<button id="startBloop">ðŸ”µ Start Homemade Looi</button>

<div class="eye-container">
  <div class="eye" id="eye1"><div class="eyelid"></div></div>
  <div class="eye" id="eye2"><div class="eyelid"></div></div>
</div>

<div class="panel">
  <div>
    <div class="status" id="status">Status: <strong id="statusText">Waiting...</strong></div>
    <div class="transcript" id="transcript">Transcript: â€”</div>
  </div>
</div>

<script>
function blink(){ const eyes=document.querySelectorAll('.eye'); eyes.forEach(e=>e.classList.add('blink')); setTimeout(()=>eyes.forEach(e=>e.classList.remove('blink')),200); }

const statusText=document.getElementById('statusText');
const transcriptEl=document.getElementById('transcript');
function setStatus(s){ statusText.textContent=s; }

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if(!SpeechRecognition){ setStatus('SpeechRecognition not supported.'); } 
else {
  const recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = false;
  recognition.lang = 'en-US';

  let speaking=false;
  let lastReply='';

  recognition.onend = ()=>{ setTimeout(()=>{ try{ recognition.start(); setStatus('Listening...'); }catch(e){ console.warn(e); } },200); }
  recognition.onerror = (e)=>{ console.warn('Recognition error',e); setStatus('Recognition error â€” retrying...'); try{ recognition.stop(); }catch(e){} setTimeout(()=>{ try{ recognition.start(); setStatus('Listening...'); }catch(e){} },700); }

  function speak(text){
    return new Promise(resolve=>{
      speaking=true;
      try{ recognition.stop(); }catch(e){}
      lastReply=text.toLowerCase();
      const u=new SpeechSynthesisUtterance(text);
      u.rate=1;
      u.pitch=1.05;
      u.onend=()=>{ setTimeout(()=>{ speaking=false; try{ recognition.start(); setStatus('Listening...'); }catch(e){console.warn(e);} resolve(); },300); }
      speechSynthesis.speak(u);
      setStatus('Speaking...');
    });
  }

  function thinking(on){ document.querySelectorAll('.eye').forEach(e=>e.classList.toggle('thinking',on)); }

  async function askAI(msg){
    thinking(true);
    setStatus('Thinking...');
    await new Promise(r=>setTimeout(r,500)); // simulate thinking
    thinking(false);
    setStatus('Idle');
    return "You said: " + msg; // dummy AI reply
  }

  recognition.onresult=(ev)=>{
    if(speaking) return;
    const text=ev.results[ev.results.length-1][0].transcript.trim();
    if(!text) return;
    if(text.toLowerCase()===lastReply) return;
    transcriptEl.textContent='Transcript: '+text;
    console.log('Heard:',text);
    blink();
    (async()=>{
      const reply=await askAI(text);
      await speak(reply);
    })();
  }

  const startBtn=document.getElementById('startBloop');
  if(startBtn){ startBtn.addEventListener('click',()=>{
    startBtn.style.display='none';
    navigator.mediaDevices.getUserMedia({audio:true}).then(()=>{ try{ recognition.start(); setStatus('Listening...'); }catch(e){console.warn(e);} }).catch(()=>{ setStatus('Microphone blocked â€” allow microphone.'); });
  }); }

  setInterval(()=>{ if(!document.querySelector('.eye').classList.contains('thinking')) blink(); }, Math.random()*3000+2000);
}
</script>
</body>
</html>
